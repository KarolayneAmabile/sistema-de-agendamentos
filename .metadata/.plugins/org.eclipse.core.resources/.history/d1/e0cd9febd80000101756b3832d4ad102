package view;

import models.Appointment;
import models.Salon;
import models.Service;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.math.BigDecimal;
import java.util.Date;
import java.util.List;

public class oi2 {
    private static Salon salon = new Salon();  // Vamos supor que o salon já tenha agendamentos e serviços
    private static JFrame frame;
    private static JTable tabela;

    public static void main(String[] args) {
        // Dados de exemplo para testar
        Service escova = new Service(1, "Escova", new BigDecimal("50.00"));
        Service corte = new Service(2, "Corte", new BigDecimal("20.00"));
        salon.addService(escova);
        salon.addService(corte);

        Appointment agendamento1 = new Appointment(1, "Ana Laura", new Date(), escova);
        Appointment agendamento2 = new Appointment(2, "Karolayne", new Date(), corte);
        salon.addAppointment(agendamento1);
        salon.addAppointment(agendamento2);

        criarJanela();
    }

    private static void criarJanela() {
        // cria a janela -> frame
        frame = new JFrame("Sistema de Agendamentos");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(800, 500);
        frame.setLayout(new BorderLayout(10, 10));

        // Painel superior (título e botões)
        JPanel painelSuperior = new JPanel(new BorderLayout());
        JLabel titulo = new JLabel("Sistema de Agendamentos", SwingConstants.CENTER);
        titulo.setFont(new Font("Arial", Font.BOLD, 20));
        painelSuperior.add(titulo, BorderLayout.CENTER);

        // Painel de botões
        JPanel painelBotoes = new JPanel();
        JButton btnNovo = new JButton("NOVO AGENDAMENTO");
        JButton btnCadastrar = new JButton("CADASTRAR SERVIÇO");

        // Ação para o botão de Novo Agendamento
        btnNovo.addActionListener(e -> abrirFormularioAgendamento());

        // Ação para o botão de Cadastrar Serviço
        btnCadastrar.addActionListener(e -> abrirFormularioServico());

        painelBotoes.add(btnNovo);
        painelBotoes.add(btnCadastrar);
        painelSuperior.add(painelBotoes, BorderLayout.EAST);

        frame.add(painelSuperior, BorderLayout.NORTH);

        // Criando a tabela de agendamentos
        String[] colunas = {"HORÁRIOS", "CLIENTE", "SERVIÇO", "PREÇO FINAL", "STATUS"};
        List<Appointment> appointments = salon.getAppointments().values().stream()
                .flatMap(List::stream)  // "Achata" a lista de listas de appointments em uma lista única
                .toList();

        Object[][] dados = new Object[appointments.size()][5];
        for (int i = 0; i < appointments.size(); i++) {
            Appointment appointment = appointments.get(i);
            dados[i][0] = appointment.getDate().toString();  // Você pode formatar isso para a forma desejada
            dados[i][1] = appointment.getCustomer();
            dados[i][2] = appointment.getService().getServiceName();
            dados[i][3] = "R$ " + appointment.getTotalValue().toString();
            dados[i][4] = "Agendado";  // Você pode alterar isso com base no status real do agendamento
        }

        DefaultTableModel model = new DefaultTableModel(dados, colunas);
        tabela = new JTable(model);
        JScrollPane scrollPane = new JScrollPane(tabela);
        frame.add(scrollPane, BorderLayout.CENTER);

        // Painel inferior (rodapé com total do dia)
        JPanel painelRodape = new JPanel(new BorderLayout());
        JLabel totalLabel = new JLabel("TOTAL DO DIA", SwingConstants.LEFT);
        totalLabel.setFont(new Font("Arial", Font.BOLD, 12));
        painelRodape.add(totalLabel, BorderLayout.WEST);

        JLabel totalValor = new JLabel("R$ " + salon.getTotal().toString(), SwingConstants.RIGHT);
        totalValor.setFont(new Font("Arial", Font.BOLD, 12));
        painelRodape.add(totalValor, BorderLayout.EAST);

        frame.add(painelRodape, BorderLayout.SOUTH);

        frame.setVisible(true);
    }

    private static void abrirFormularioAgendamento() {
        // Exibe o painel ou janela para criar um novo agendamento
        JPanel painelAgendamento = new JPanel();
        painelAgendamento.setLayout(new GridLayout(5, 2));

        JTextField nomeCliente = new JTextField();
        JTextField dataHora = new JTextField();
        JComboBox<Service> comboServico = new JComboBox<>(salon.getServices().toArray(new Service[0]));

        painelAgendamento.add(new JLabel("Nome do Cliente:"));
        painelAgendamento.add(nomeCliente);
        painelAgendamento.add(new JLabel("Data e Hora:"));
        painelAgendamento.add(dataHora);
        painelAgendamento.add(new JLabel("Serviço:"));
        painelAgendamento.add(comboServico);

        int option = JOptionPane.showConfirmDialog(frame, painelAgendamento, "Novo Agendamento", JOptionPane.OK_CANCEL_OPTION);
        if (option == JOptionPane.OK_OPTION) {
            // Criar o agendamento aqui
            String cliente = nomeCliente.getText();
            String data = dataHora.getText();
            Service servico = (Service) comboServico.getSelectedItem();
            // Aqui, você deve validar a data e criar o agendamento
            Appointment novoAgendamento = new Appointment(3, cliente, new Date(), servico);  // Substituir pelo agendamento correto
            salon.addAppointment(novoAgendamento);
            JOptionPane.showMessageDialog(frame, "Agendamento Criado com Sucesso!");
            frame.dispose();
            criarJanela(); // Recarregar a tela
        }
    }

    private static void abrirFormularioServico() {
        // Exibe o painel ou janela para cadastrar um novo serviço
        JPanel painelServico = new JPanel();
        painelServico.setLayout(new GridLayout(3, 2));

        JTextField nomeServico = new JTextField();
        JTextField precoServico = new JTextField();

        painelServico.add(new JLabel("Nome do Serviço:"));
        painelServico.add(nomeServico);
        painelServico.add(new JLabel("Preço do Serviço:"));
        painelServico.add(precoServico);

        int option = JOptionPane.showConfirmDialog(frame, painelServico, "Novo Serviço", JOptionPane.OK_CANCEL_OPTION);
        if (option == JOptionPane.OK_OPTION) {
            // Criar o serviço aqui
            String nome = nomeServico.getText();
            BigDecimal preco = new BigDecimal(precoServico.getText());
            Service novoServico = new Service(3, nome, preco);  // Substituir pelo serviço correto
            salon.addService(novoServico);
            JOptionPane.showMessageDialog(frame, "Serviço Criado com Sucesso!");
            frame.dispose();
            criarJanela(); // Recarregar a tela
        }
    }
}

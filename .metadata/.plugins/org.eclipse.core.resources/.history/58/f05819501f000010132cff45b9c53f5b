package view;

import controller.SalonController;
import models.Salon;
import models.SalonListener;
import models.SalonEvent;

import javax.swing.*;
import java.awt.*;

public class MainView extends JFrame implements SalonListener {

    private SalonController controller;
    private JButton btnNovo;
    private JButton btnCadastrar;
    private JTable tabela;
    private JLabel totalValor;

    private AppointmentPanel appointmentPanel;
    private ServicePanel servicePanel;

    public MainView(SalonController controller) {
        this.controller = controller;
        this.controller.addSalonListener(this);

        inicializarComponentes();
    }

    private void inicializarComponentes() {
        setTitle("Sistema de Agendamentos");
        setSize(800, 500);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout(10, 10));

        JPanel painelSuperior = new JPanel(new BorderLayout());
        JLabel titulo = new JLabel("Sistema de Agendamentos", SwingConstants.CENTER);
        titulo.setFont(new Font("Arial", Font.BOLD, 20));
        painelSuperior.add(titulo, BorderLayout.CENTER);

        JPanel painelBotoes = new JPanel();
        btnNovo = new JButton("NOVO AGENDAMENTO");
        btnCadastrar = new JButton("CADASTRAR SERVIÇO");
        painelBotoes.add(btnNovo);
        painelBotoes.add(btnCadastrar);
        painelSuperior.add(painelBotoes, BorderLayout.EAST);
        add(painelSuperior, BorderLayout.NORTH);

        // Tabela de agendamentos
        String[] colunas = {"HORÁRIOS", "CLIENTE", "SERVIÇO", "PREÇO FINAL", "STATUS"};
        Object[][] dados = {};
        tabela = new JTable(dados, colunas);
        JScrollPane scrollPane = new JScrollPane(tabela);
        add(scrollPane, BorderLayout.CENTER);

        // Rodapé
        JPanel painelRodape = new JPanel(new BorderLayout());
        JLabel totalLabel = new JLabel("TOTAL DO DIA", SwingConstants.LEFT);
        totalValor = new JLabel("R$ 0,00", SwingConstants.RIGHT);
        painelRodape.add(totalLabel, BorderLayout.WEST);
        painelRodape.add(totalValor, BorderLayout.EAST);
        add(painelRodape, BorderLayout.SOUTH);

        // Paineis extras
        appointmentPanel = new AppointmentPanel(controller);
        servicePanel = new ServicePanel(controller);

        // Ações dos botões
        btnNovo.addActionListener(e -> exibirAppointmentPanel());
        btnCadastrar.addActionListener(e -> exibirServicePanel());
    }

    private void exibirAppointmentPanel() {
        appointmentPanel.setVisible(true);
    }

    private void exibirServicePanel() {
        servicePanel.setVisible(true);
    }

    @Override
    public void update(SalonEvent event) {
        // Atualizar a tabela com novos agendamentos
        totalValor.setText("R$ " + controller.getTotalDoDia());
    }
}
